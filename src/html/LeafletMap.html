<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LeafletMap</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="../lib/proj4-compressed.js"></script>
    <script src="../js/proj4leaflet.js"></script>
    <script src="../js/vue.min.js"></script>
    <script src="../js/leaflet.rotatedMarker.js"></script>
    <style>
        #mapContainer {
            width: 640px;
            height: 560px;
            position: relative
        }

        #LeafletMap {
            width: 640px;
            height: 560px;
            position: absolute;
            z-index: 1;
        }

        #latlngInfo {
            width: 200px;
            height: 200px;
            position: absolute;
            right: 100px;
            bottom: 0;
            z-index: 2;
        }

        p {
            color: red
        }
    </style>
</head>
<body>
<div id="mapContainer">
    <div id="LeafletMap"></div>
    <div id="latlngInfo" v-html="info"></div>
</div>
</body>
<script>
    //各地经纬坐标
    var nanJing = L.latLng(32.04, 118.78);
    var wuXi = L.latLng(31.59, 120.29);
    var suZhou = L.latLng(31.32, 120.62);
    var shangHai = L.latLng(31.23, 121.47);
    //坐标参考系统
    var crs = new L.Proj.CRS(
        'EPSG:3395',
        '+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs',
        {
            resolutions: function () {
                level = 19;
                var res = [];
                res[0] = Math.pow(2, 18);
                for (var i = 1; i < level; i++) {
                    res[i] = Math.pow(2, (18 - i))
                }
                return res;
            }(),
            origin: [0, 0],
            bounds: L.bounds([20037508.342789244, 0], [0, 20037508.342789244])
        }
    );
    //获取地图
    var leafletMap = L.map('LeafletMap', {crs: crs});
    //测试经纬坐标
    var testLatLng = shangHai;
    //设置中心点和缩放等级
    leafletMap.setView(testLatLng, 8);
    //鼠标移动获取坐标
    var latlngInfo = {info: ''};
    leafletMap.on('mousemove', function (e) {
        latlngInfo.info = '<h4>纬度：</h4><p>' + e.latlng.lat + '</p><h4>经度：</h4><p>' + e.latlng.lng + '</p>';
    });
    //vue数据绑定
    new Vue({
        el: '#latlngInfo',
        data: latlngInfo
    });
    //添加瓦片图层
    L.tileLayer(
        'http://online{s}.map.bdimg.com/tile/?qt=tile&x={x}&y={y}&z={z}&styles=pl&udt=20150518',
        {
            maxZoom: 18,
            minZoom: 3,
            subdomains: [0, 1, 2],
            tms: true
        }
    ).addTo(leafletMap);
    //GeoJSON图层
    var geoJsonData = [
        {
            "type": "Feature",
            "properties": {
                "name": "nanJins",
                "popupContent": "这里是南京！"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [118.78, 32.04]//[经度，纬度]跟L.latLng方法定义的参数相反
            }
        }, {
            "type": "Feature",
            "properties": {
                "name": "shangHai",
                "popupContent": "这里是上海！"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [121.47, 31.23]
            }
        }, {
            "type": "Feature",
            "properties": {
                "name": "shangHai",
                "popupContent": "这里是无锡！"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [120.29, 31.59]
            }
        }, {
            "type": "Feature",
            "properties": {
                "name": "shangHai",
                "popupContent": "这里是苏州！"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [120.62, 31.32]
            }
        }
    ];
    //marker icon
    var myIcon = L.icon({
        iconUrl: '../img/marker_icon.png',
        iconSize: [64, 64],
        iconAnchor: [32, 58],
        //popupAnchor: [-3, -76],
        //shadowUrl: 'my-icon-shadow.png',
        //shadowSize: [68, 95],
        //shadowAnchor: [22, 94]
    });
    var geojsonMarkerOptions = {
        radius: 8,
        fillColor: "#ff7800",
        color: "#000",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
    };
    function onEachFeature(feature, layer) {
        var popupContent = '';
        if (feature.properties && feature.properties.popupContent) {
            popupContent = feature.properties.popupContent +
                '</br>这个标记的经纬度是：</br>纬度：' +
                feature.geometry.coordinates[1] +
                '</br>经度：' + feature.geometry.coordinates[0];
        }
        layer.bindPopup(popupContent);
    }
    L.geoJSON(
        geoJsonData,
        {
            pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {icon: myIcon});
            },
            onEachFeature: onEachFeature
        }
    ).addTo(leafletMap);
    //标记点
    //    L.marker(nanJing, {rotationAngel: 180})
    //        .addTo(leafletMap);
    //    L.marker(testLatLng, {icon: myIcon, rotationAngel: 180})
    //        .addTo(leafletMap)
    //        .on('click', function (e) {
    //            L.popup()
    //                .setLatLng(e.latlng)
    //                .setContent('这个标记的经纬度是：</br>纬度：' + e.latlng.lat + '</br>经度：' + e.latlng.lng)
    //                .openOn(leafletMap);
    //            console.log(e);
    //        });
    //警戒范围
    //    L.circle(
    //        testLatLng,
    //        50,
    //        {
    //            color: 'red',//表示边框颜色
    //            fillColor: '#ff0000',//表示填充颜色
    //            fillOpacity: 0.5//表示透明度
    //            //radius 表示圆的半径
    //        }
    //    ).addTo(leafletMap);
    //安全范围
    //    L.circle(
    //        testLatLng,
    //        100,
    //        {
    //            color: 'green',
    //            fillColor: '#aaffff',
    //            fillOpacity: 0.5
    //        }
    //    ).addTo(leafletMap);
    //比例尺
    //L.control.scale().addTo(leafletMap);
</script>
</html>
